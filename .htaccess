php_value error_reporting 6135
php_flag ignore_repeated_errors off
php_flag ignore_repeated_source off
php_flag display_errors on
php_flag html_errors on
RewriteEngine on
ExpiresActive on


# Fix Apache internal dummy connections from breaking [(site_url)], generating /* URI requests to the webapp 
RewriteCond %{HTTP_USER_AGENT} ^.*internal\ dummy\ connection.*$ [NC]
RewriteRule .* - [F,L]

#Rewrite rule for more robust caching (ie: file-023.js -> file.js, file-024.js -> file.js)
#Every time a file changes, a new url is generated and is mapped to the original file name
RewriteRule ^(.+)-(\d+).(js|css)$ $1.$3 [L]
#Also implement same rewrite for image resources under /images directory only (notice is NOT the img for user uploaded files)
RewriteCond %{REQUEST_URI} /images/
RewriteRule ^(.+)-(\d+).(ico|pdf|jpg|jpeg|png|gif)$ $1.$3 [L]

# if a directory or a file exists, use it directly
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# otherwise forward it to index.php
RewriteRule . index.php

#  Rewrite subdomains (TODO: Disabled for now, lots of issues. apache not stable, or bad site design for domain rewrite with yii pages)
#RewriteCond %{HTTP_HOST} !^www.* [NC]
#RewriteCond %{HTTP_HOST} ^([^\.]+)\.samesub\.com
#RewriteRule ^(.*) /%1/$1 [L]

#RewriteBase /
#RewriteCond %{HTTP_HOST} !^samesub\.com [NC]
#RewriteCond %{REQUEST_URI}!^something
#RewriteCond %{HTTP_HOST} ^([^.]+)\.samesub\.com
#RewriteRule (.*) http://samesub.com/%1/$1 [P,L]

#RewriteCond %{HTTP_HOST} !^www.* [NC]
#RewriteCond %{HTTP_HOST} ^api\.samesub\.com
#RewriteCond %{REQUEST_URI} !^webmail/ [NC]
#RewriteRule ^(.*) /api/$1 [P,L]


# FILE CACHING (Client Side - Browser) Directives
# http://www.askapache.com/htaccess/apache-speed-cache-control.html
# cache all resources files for 1 year as this are going to change with the url in the filename with the RewriteRule on the calling dynamically generated html page
# We dont set for more than a year because that would full the user's browser cache
<FilesMatch "\.(ico|pdf|jpg|jpeg|png|gif)$">
	Header unset Pragma
	FileETag None
	Header unset ETag
	#Header set Cache-Control "max-age=2419200, public, must-revalidate"
	#Header set Expires "Thu, 15 Apr 2020 20:00:00 GMT"
	Header set Cache-Control "public"	
	ExpiresDefault "access plus 1 year"
	Header unset Last-Modified
</FilesMatch>
<FilesMatch "(\.css|\.js)$">
	Header unset Pragma
	FileETag None
	Header unset ETag
	#ExpiresDefault A29030400
	#Header set Expires "Thu, 15 Apr 2020 20:00:00 GMT"
	Header set Cache-Control "public"	
	ExpiresDefault "access plus 1 year"
	Header unset Last-Modified
</FilesMatch>

